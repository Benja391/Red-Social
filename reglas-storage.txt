rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Archivos relacionados con publicaciones
    match /posts/{postId}/{fileName} {
      // Todos los usuarios autenticados pueden leer archivos de publicaciones
      allow read: if request.auth != null;

      // Solo el creador de la publicación o un administrador puede subir o eliminar archivos
      allow write: if request.auth != null && 
                    (request.auth.uid == resource.data.userId || request.auth.token.admin == true);
    }

    // Archivos de imágenes de perfil
    match /profile_images/{userId}/{fileName} {
      // Todos los usuarios autenticados pueden leer imágenes de perfil
      allow read: if request.auth != null;

      // Solo el usuario propietario de la cuenta puede subir o eliminar su imagen de perfil
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
